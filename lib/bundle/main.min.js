!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t["caret-pos"]={})}(this,function(t){"use strict";var a=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle","borderTopWidth","boxSizing","fontFamily","fontSize","fontWeight","height","letterSpacing","lineHeight","marginBottom","marginLeft","marginRight","marginTop","outlineWidth","overflow","overflowX","overflowY","paddingBottom","paddingLeft","paddingRight","paddingTop","textAlign","textOverflow","textTransform","whiteSpace","wordBreak","wordWrap"],h=function(e,t){var n,r,o,i=document.createElement("div");return n=t,r={position:"absolute",left:-9999,top:0,zIndex:-2e3},"TEXTAREA"===e.tagName&&a.push("width"),a.forEach(function(t){r[t]=getComputedStyle(e)[t]}),o=r,Object.keys(o).forEach(function(t){i.style[t]=o[t]}),i.innerHTML=n,e.parentNode.insertBefore(i,e.nextSibling),{rect:function(){var t=i.ownerDocument.getElementById("caret-position-marker"),e={left:t.offsetLeft,top:t.offsetTop,height:t.offsetHeight};return i.parentNode.removeChild(i),e}}},e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}(),g=function(t){return!(!t.contentEditable||"true"!==t.contentEditable)},i=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.customPos,n=t.iframe,r=t.noShadowCaret;return n?{iframe:n,window:n.contentWindow,document:n.contentDocument||n.contentWindow.document,noShadowCaret:r,customPos:e}:{window:window,document:document,noShadowCaret:r,customPos:e}},p=function(t,e){var n=e&&e.window||window,r=e&&e.document||document,o=t.getBoundingClientRect(),i=r.documentElement,a=n.pageXOffset||i.scrollLeft,s=n.pageYOffset||i.scrollTop;return{top:o.top+s,left:o.left+a}},s=function(t){return"object"===(void 0===t?"undefined":e(t))&&null!==t},r=function(t){var e=t.nodeName;return"TEXTAREA"==e||"INPUT"==e},u=function(t){return r(t)||(t=function t(e){return g(e)?e:!!e.parentElement&&t(e.parentElement)}(t)),t},l=function n(t){return t instanceof NodeList&&[].slice.call(t).reduce(function(t,e){return t+n(e)},""),t instanceof Element?r(t)?t.value:t.innerHTML.replace(/(<([^>]+)>)/gi,""):""},c=function(t){return t&&"[object Function]"==={}.toString.call(t)},f=function(t,e){return g(t)?(c=t,f=e,{get:function(){if(f.window.getSelection){var t=f.window.getSelection();if(0<t.rangeCount){var e=t.getRangeAt(0);return{element:e.startContainer,Start:e.startOffset,End:e.endOffset}}}},getPos:a=function(){var t=d(),e=t.cloneRange();e.selectNodeContents(c),e.setEnd(t.endContainer,t.endOffset);var n=e.toString().length;return e.detach(),n},setPos:function(a){var s=f.window.getSelection();if(s){var u=0,l=!1;!function t(e,n){for(var r=0;r<n.childNodes.length;r++){var o=n.childNodes[r];if(l)break;if(3===o.nodeType){if(u+o.length>=e){l=!0;var i=f.document.createRange();i.setStart(o,e-u),s.removeAllRanges(),s.addRange(i);break}u+=o.length}else t(a,o)}}(a,c)}return c},getPosition:function(){var t=i(),e=a(),n=c.getBoundingClientRect(),r=n.top+f.document.body.scrollTop,o=n.left+f.document.body.scrollLeft;return t.left-=o,t.top-=r,t.pos=e,t},getOffset:i=function(){var t=d(),e={height:0,left:0,right:0};if(!t)return e;var n=f.customPos||0===f.customPos;if(0<t.endOffset-1&&t.endContainer!==c||n){var r=t.cloneRange(),o=n?f.customPos:t.endOffset;r.setStart(t.endContainer,o-1<0?0:o-1),r.setEnd(t.endContainer,o);var i=r.getBoundingClientRect();e={height:i.height,left:i.left+i.width,top:i.top},r.detach()}if((!e||e&&0===e.height)&&!f.noShadowCaret){var a=t.cloneRange(),s=f.document.createTextNode("|");a.insertNode(s),a.selectNode(s);var u=a.getBoundingClientRect();e={height:u.height,left:u.left,top:u.top},s.parentNode.removeChild(s),a.detach()}if(e){var l=f.document.documentElement;e.top+=f.window.pageYOffset-(l.clientTop||0),e.left+=f.window.pageXOffset-(l.clientLeft||0)}return e},getRange:d=function(){if(f.window.getSelection){var t=f.window.getSelection();return 0<t.rangeCount?t.getRangeAt(0):null}}}):(s=t,u=e,r=function(t){var e=function(t){return t.replace(/<|>|`|"|&/g,"?").replace(/\r\n|\r|\n/g,"<br/>")};(u.customPos||0===u.customPos)&&(t=u.customPos);var n=void 0===t?l():t,r=s.value.slice(0,n),o=s.value.slice(n),i='<span style="position: relative; display: inline;">'+e(r)+"</span>";i+='<span id="caret-position-marker" style="position: relative; display: inline;">|</span>',i+='<span style="position: relative; display: inline;">'+e(o)+"</span>";var a=h(s,i).rect();return a.pos=l(),a},{get:function(){return{element:s,Start:s.selectionStart,End:s.selectionEnd}},getPos:l=function(){return s.selectionStart},setPos:function(t){return s.setSelectionRange(t,t),s},getOffset:function(t){var e=p(s),n=r(t);return{top:e.top+n.top+u.document.body.scrollTop,left:e.left+n.left+u.document.body.scrollLeft,height:n.height}},getPosition:r});var c,f,i,d,a,s,u,l,r},d=Object.freeze({position:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};s(e)&&(n=e,e=null);var r=i(n),o=f(t,r);return e||0===e?o.setPos(e):o.getPosition()},caretPosition:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};s(e)&&(n=e,e=null);var r=i(n);return f(t,r)},offset:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};s(e)&&(n=e,e=null);var r=i(n);return f(t,r).getOffset(e)},getOffset:p}),v=function(){function t(){o(this,t),this.CaretPos=d,this.caret,this.target,this.startAt,this.stopAt}return n(t,[{key:"_triggerCaretChange",value:function(e){this.caretChangeHandler.map(function(t){t(e)})}},{key:"_triggerCaretOff",value:function(e){this.caretOffHandler.map(function(t){t(e)})}},{key:"_triggerCaretOn",value:function(e){this.caretOnHandler.map(function(t){t(e)})}},{key:"onCaretChange",value:function(t){if(!c(t))throw new Error("onCaretChange must receive a function as parameter");this.caretChangeHandler.push(t)}},{key:"onCaretOff",value:function(t){if(!c(t))throw new Error("onCaretOff must receive a function as parameter");this.caretOffHandler.push(t)}},{key:"onCaretOn",value:function(t){if(!c(t))throw new Error("onCaretOn must receive a function as parameter");this.caretOnHandler.push(t)}},{key:"disable",value:function(){null!=this.target&&(this.target.removeEventListener("blur",this._autoDisableHandler,!0),this._triggerCaretOff({type:"CaretOff",target:this.target})),this.target=null,this.startAt=null,this.stopAt=null}},{key:"_autoDisableHandler",value:function(){}},{key:"enable",value:function(t){if(!(t instanceof Element))throw new Error("Caret must receive an Element as target");this.caret=this.CaretPos.caretPosition(t);var e=this.caret.get();if(isNaN(e.Start)||isNaN(e.End)||e.Start<0||e.End<0)throw new Error("Troubble during Ranging");if(this.target!=t){this._triggerCaretOn({type:"CaretOn",target:t});var n=this;this._autoDisableHandler=function(){n.disable()},t.addEventListener("blur",this._autoDisableHandler,!0)}this.target=t,this.startAt=e.Start,this.stopAt=e.End}},{key:"getTarget",value:function(){return this.target}},{key:"getSelectedText",value:function(){return this.target&&this.startAt!=this.stopAt?l(this.target).substring(this.startAt,this.stopAt):null}},{key:"getCharBeforCaret",value:function(){return!this.target||this.startAt<1?null:l(this.target).charAt(this.startAt-1)}}]),t}(),m=function(t){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];o(this,r);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return n.caretChangeHandler=[],n.caretOffHandler=[],n.caretOnHandler=[],e&&("complete"!==document.readyState?window.onload=function(){return n._init(t)}:n._init(t)),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(r,v),n(r,[{key:"_init",value:function(t){var e=this;"string"==typeof t&&(t=document.querySelectorAll(t));var n=function(t){t.addEventListener("keyup",e._handleEvent.bind(e),!0),t.addEventListener("mouseup",e._handleEvent.bind(e),!0)};t instanceof NodeList?t.forEach(n):t instanceof Element?n(t):t instanceof Document&&n(t)}},{key:"_beforeHandleBlurEvent",value:function(){}},{key:"_handleEvent",value:function(t){t.preventDefault();var e;return!1!==(e=u(t.target))?(this.enable(e),this._triggerCaretChange({type:"CaretChange",target:this.target,caret:this.caret,startAt:this.startAt,stopAt:this.stopAt,content:l(this.target),selectedText:this.getSelectedText(),charBeforCaret:this.getCharBeforCaret()})):this.disable(),!0}}]),r}();t.Caret=m,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=main.min.js.map
