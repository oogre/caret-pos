!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t["caret-pos"]={})}(this,function(t){"use strict";var a=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle","borderTopWidth","boxSizing","fontFamily","fontSize","fontWeight","height","letterSpacing","lineHeight","marginBottom","marginLeft","marginRight","marginTop","outlineWidth","overflow","overflowX","overflowY","paddingBottom","paddingLeft","paddingRight","paddingTop","textAlign","textOverflow","textTransform","whiteSpace","wordBreak","wordWrap"],g=function(e,t){var n,o,r,i=document.createElement("div");return n=t,o={position:"absolute",left:-9999,top:0,zIndex:-2e3},"TEXTAREA"===e.tagName&&a.push("width"),a.forEach(function(t){o[t]=getComputedStyle(e)[t]}),r=o,Object.keys(r).forEach(function(t){i.style[t]=r[t]}),i.innerHTML=n,e.parentNode.insertBefore(i,e.nextSibling),{rect:function(){var t=i.ownerDocument.getElementById("caret-position-marker"),e={left:t.offsetLeft,top:t.offsetTop,height:t.offsetHeight};return i.parentNode.removeChild(i),e}}},e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}}(),i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},c=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.customPos,n=t.iframe,o=t.noShadowCaret;return n?{iframe:n,window:n.contentWindow,document:n.contentDocument||n.contentWindow.document,noShadowCaret:o,customPos:e}:{window:window,document:document,noShadowCaret:o,customPos:e}},h=function(t,e){var n=e&&e.window||window,o=e&&e.document||document,r=t.getBoundingClientRect(),i=o.documentElement,a=n.pageXOffset||i.scrollLeft,l=n.pageYOffset||i.scrollTop;return{top:r.top+l,left:r.left+a}},u=function(t){return"object"===(void 0===t?"undefined":e(t))&&null!==t},s=function(t,e){return(n=t).contentEditable&&"true"===n.contentEditable?(s=t,f=e,{get:function(){if(f.window.getSelection){var t=f.window.getSelection();if(0<t.rangeCount){var e=t.getRangeAt(0);return{element:e.startContainer,Start:e.startOffset,End:e.endOffset}}}},getPos:a=function(){var t=d(),e=t.cloneRange();e.selectNodeContents(s),e.setEnd(t.endContainer,t.endOffset);var n=e.toString().length;return e.detach(),n},setPos:function(a){var l=f.window.getSelection();if(l){var c=0,u=!1;!function t(e,n){for(var o=0;o<n.childNodes.length;o++){var r=n.childNodes[o];if(u)break;if(3===r.nodeType){if(c+r.length>=e){u=!0;var i=f.document.createRange();i.setStart(r,e-c),l.removeAllRanges(),l.addRange(i);break}c+=r.length}else t(a,r)}}(a,s)}return s},getPosition:function(){var t=i(),e=a(),n=s.getBoundingClientRect(),o=n.top+f.document.body.scrollTop,r=n.left+f.document.body.scrollLeft;return t.left-=r,t.top-=o,t.pos=e,t},getOffset:i=function(){var t=d(),e={height:0,left:0,right:0};if(!t)return e;var n=f.customPos||0===f.customPos;if(0<t.endOffset-1&&t.endContainer!==s||n){var o=t.cloneRange(),r=n?f.customPos:t.endOffset;o.setStart(t.endContainer,r-1<0?0:r-1),o.setEnd(t.endContainer,r);var i=o.getBoundingClientRect();e={height:i.height,left:i.left+i.width,top:i.top},o.detach()}if((!e||e&&0===e.height)&&!f.noShadowCaret){var a=t.cloneRange(),l=f.document.createTextNode("|");a.insertNode(l),a.selectNode(l);var c=a.getBoundingClientRect();e={height:c.height,left:c.left,top:c.top},l.parentNode.removeChild(l),a.detach()}if(e){var u=f.document.documentElement;e.top+=f.window.pageYOffset-(u.clientTop||0),e.left+=f.window.pageXOffset-(u.clientLeft||0)}return e},getRange:d=function(){if(f.window.getSelection){var t=f.window.getSelection();return 0<t.rangeCount?t.getRangeAt(0):null}}}):(l=t,c=e,o=function(t){var e=function(t){return t.replace(/<|>|`|"|&/g,"?").replace(/\r\n|\r|\n/g,"<br/>")};(c.customPos||0===c.customPos)&&(t=c.customPos);var n=void 0===t?u():t,o=l.value.slice(0,n),r=l.value.slice(n),i='<span style="position: relative; display: inline;">'+e(o)+"</span>";i+='<span id="caret-position-marker" style="position: relative; display: inline;">|</span>',i+='<span style="position: relative; display: inline;">'+e(r)+"</span>";var a=g(l,i).rect();return a.pos=u(),a},{get:function(){return{element:l,Start:l.selectionStart,End:l.selectionEnd}},getPos:u=function(){return l.selectionStart},setPos:function(t){return l.setSelectionRange(t,t),l},getOffset:function(t){var e=h(l),n=o(t);return{top:e.top+n.top+c.document.body.scrollTop,left:e.left+n.left+c.document.body.scrollLeft,height:n.height}},getPosition:o});var s,f,i,d,a,n,l,c,u,o},o=Object.freeze({position:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};u(e)&&(n=e,e=null);var o=c(n),r=s(t,o);return e||0===e?r.setPos(e):r.getPosition()},caretPosition:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};u(e)&&(n=e,e=null);var o=c(n);return s(t,o)},offset:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};u(e)&&(n=e,e=null);var o=c(n);return s(t,o).getOffset(e)},getOffset:h}),f=function(){function e(){r(this,e)}return n(e,null,[{key:"getContentEditableInParent",value:function(t){return t.hasAttribute("contenteditable")?t:!!t.parentElement&&e.getContentEditableInParent(t.parentElement)}},{key:"isInputField",value:function(t){var e=t.nodeName;return"TEXTAREA"==e||"INPUT"==e}},{key:"checkTarget",value:function(t){return e.isInputField(t)||(t=e.getContentEditableInParent(t)),t}},{key:"getContent",value:function(t){return t.value||t.innerText}}]),e}(),d=function(t){function e(){r(this,e);var t=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.CaretPos=o,t.caret,t.target,t.startAt,t.stopAt,t}return i(e,f),n(e,[{key:"disable",value:function(){this.target=null,this.startAt=null,this.stopAt=null}},{key:"enable",value:function(t){if(!(t instanceof Element))throw new Error("Caret must receive an Element as target");this.caret=this.CaretPos.caretPosition(t);var e=this.caret.get();if(isNaN(e.Start)||isNaN(e.End)||e.Start<0||e.End<0)throw new Error("Troubble during Ranging");this.target=t,this.startAt=e.Start,this.stopAt=e.End}},{key:"getTarget",value:function(){return this.target}},{key:"getSelectedText",value:function(){return this.target&&this.startAt!=this.stopAt?f.getContent(this.target).substring(this.startAt,this.stopAt):null}},{key:"getCharBeforCaret",value:function(){return!this.target||this.startAt<1?null:f.getContent(this.target).charAt(this.startAt-1)}}]),e}(),p=function(t){function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document;r(this,o);var n=l(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return window.onload=function(){"string"==typeof e&&(e=document.querySelectorAll(e));var t=function(t){t.addEventListener("keyup",n._handleEvent.bind(n)),t.addEventListener("mouseup",n._handleEvent.bind(n))};e instanceof NodeList?e.forEach(t):e instanceof Element?t(e):e instanceof Document&&t(e)},n.caretChangeHandler=[],n}return i(o,d),n(o,[{key:"_handleEvent",value:function(t){var e;!1!==(e=d.checkTarget(t.target))?(this.enable(e),this._triggerCaretChange({target:this.target,caret:this.caret,selectedText:this.getSelectedText(),charBeforCaret:this.getCharBeforCaret()})):this.disable()}},{key:"_triggerCaretChange",value:function(e){this.caretChangeHandler.map(function(t){t(e)})}},{key:"onCaretChange",value:function(t){t&&"[object Function]"==={}.toString.call(t)&&this.caretChangeHandler.push(t)}}]),o}();t.Caret=p,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=main.min.js.map
