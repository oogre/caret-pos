!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("util")):"function"==typeof define&&define.amd?define(["exports","util"],t):t(e["caret-pos"]={},e.util)}(this,function(e,r){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r;var a=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle","borderTopWidth","boxSizing","fontFamily","fontSize","fontWeight","height","letterSpacing","lineHeight","marginBottom","marginLeft","marginRight","marginTop","outlineWidth","overflow","overflowX","overflowY","paddingBottom","paddingLeft","paddingRight","paddingTop","textAlign","textOverflow","textTransform","whiteSpace","wordBreak","wordWrap"],h=function(t,e){var n,r,o,i=document.createElement("div");return n=e,r={position:"absolute",left:-9999,top:0,zIndex:-2e3},"TEXTAREA"===t.tagName&&a.push("width"),a.forEach(function(e){r[e]=getComputedStyle(t)[e]}),o=r,Object.keys(o).forEach(function(e){i.style[e]=o[e]}),i.innerHTML=n,t.parentNode.insertBefore(i,t.nextSibling),{rect:function(){var e=i.ownerDocument.getElementById("caret-position-marker"),t={left:e.offsetLeft,top:e.offsetTop,height:e.offsetHeight};return i.parentNode.removeChild(i),t}}};var t,o={EncodeType:"entity",isEmpty:function(e){return!e||(null===e||0==e.length||/^\s+$/.test(e))},arr1:["&nbsp;","&iexcl;","&cent;","&pound;","&curren;","&yen;","&brvbar;","&sect;","&uml;","&copy;","&ordf;","&laquo;","&not;","&shy;","&reg;","&macr;","&deg;","&plusmn;","&sup2;","&sup3;","&acute;","&micro;","&para;","&middot;","&cedil;","&sup1;","&ordm;","&raquo;","&frac14;","&frac12;","&frac34;","&iquest;","&Agrave;","&Aacute;","&Acirc;","&Atilde;","&Auml;","&Aring;","&AElig;","&Ccedil;","&Egrave;","&Eacute;","&Ecirc;","&Euml;","&Igrave;","&Iacute;","&Icirc;","&Iuml;","&ETH;","&Ntilde;","&Ograve;","&Oacute;","&Ocirc;","&Otilde;","&Ouml;","&times;","&Oslash;","&Ugrave;","&Uacute;","&Ucirc;","&Uuml;","&Yacute;","&THORN;","&szlig;","&agrave;","&aacute;","&acirc;","&atilde;","&auml;","&aring;","&aelig;","&ccedil;","&egrave;","&eacute;","&ecirc;","&euml;","&igrave;","&iacute;","&icirc;","&iuml;","&eth;","&ntilde;","&ograve;","&oacute;","&ocirc;","&otilde;","&ouml;","&divide;","&oslash;","&ugrave;","&uacute;","&ucirc;","&uuml;","&yacute;","&thorn;","&yuml;","&quot;","&amp;","&lt;","&gt;","&OElig;","&oelig;","&Scaron;","&scaron;","&Yuml;","&circ;","&tilde;","&ensp;","&emsp;","&thinsp;","&zwnj;","&zwj;","&lrm;","&rlm;","&ndash;","&mdash;","&lsquo;","&rsquo;","&sbquo;","&ldquo;","&rdquo;","&bdquo;","&dagger;","&Dagger;","&permil;","&lsaquo;","&rsaquo;","&euro;","&fnof;","&Alpha;","&Beta;","&Gamma;","&Delta;","&Epsilon;","&Zeta;","&Eta;","&Theta;","&Iota;","&Kappa;","&Lambda;","&Mu;","&Nu;","&Xi;","&Omicron;","&Pi;","&Rho;","&Sigma;","&Tau;","&Upsilon;","&Phi;","&Chi;","&Psi;","&Omega;","&alpha;","&beta;","&gamma;","&delta;","&epsilon;","&zeta;","&eta;","&theta;","&iota;","&kappa;","&lambda;","&mu;","&nu;","&xi;","&omicron;","&pi;","&rho;","&sigmaf;","&sigma;","&tau;","&upsilon;","&phi;","&chi;","&psi;","&omega;","&thetasym;","&upsih;","&piv;","&bull;","&hellip;","&prime;","&Prime;","&oline;","&frasl;","&weierp;","&image;","&real;","&trade;","&alefsym;","&larr;","&uarr;","&rarr;","&darr;","&harr;","&crarr;","&lArr;","&uArr;","&rArr;","&dArr;","&hArr;","&forall;","&part;","&exist;","&empty;","&nabla;","&isin;","&notin;","&ni;","&prod;","&sum;","&minus;","&lowast;","&radic;","&prop;","&infin;","&ang;","&and;","&or;","&cap;","&cup;","&int;","&there4;","&sim;","&cong;","&asymp;","&ne;","&equiv;","&le;","&ge;","&sub;","&sup;","&nsub;","&sube;","&supe;","&oplus;","&otimes;","&perp;","&sdot;","&lceil;","&rceil;","&lfloor;","&rfloor;","&lang;","&rang;","&loz;","&spades;","&clubs;","&hearts;","&diams;"],arr2:["&#160;","&#161;","&#162;","&#163;","&#164;","&#165;","&#166;","&#167;","&#168;","&#169;","&#170;","&#171;","&#172;","&#173;","&#174;","&#175;","&#176;","&#177;","&#178;","&#179;","&#180;","&#181;","&#182;","&#183;","&#184;","&#185;","&#186;","&#187;","&#188;","&#189;","&#190;","&#191;","&#192;","&#193;","&#194;","&#195;","&#196;","&#197;","&#198;","&#199;","&#200;","&#201;","&#202;","&#203;","&#204;","&#205;","&#206;","&#207;","&#208;","&#209;","&#210;","&#211;","&#212;","&#213;","&#214;","&#215;","&#216;","&#217;","&#218;","&#219;","&#220;","&#221;","&#222;","&#223;","&#224;","&#225;","&#226;","&#227;","&#228;","&#229;","&#230;","&#231;","&#232;","&#233;","&#234;","&#235;","&#236;","&#237;","&#238;","&#239;","&#240;","&#241;","&#242;","&#243;","&#244;","&#245;","&#246;","&#247;","&#248;","&#249;","&#250;","&#251;","&#252;","&#253;","&#254;","&#255;","&#34;","&#38;","&#60;","&#62;","&#338;","&#339;","&#352;","&#353;","&#376;","&#710;","&#732;","&#8194;","&#8195;","&#8201;","&#8204;","&#8205;","&#8206;","&#8207;","&#8211;","&#8212;","&#8216;","&#8217;","&#8218;","&#8220;","&#8221;","&#8222;","&#8224;","&#8225;","&#8240;","&#8249;","&#8250;","&#8364;","&#402;","&#913;","&#914;","&#915;","&#916;","&#917;","&#918;","&#919;","&#920;","&#921;","&#922;","&#923;","&#924;","&#925;","&#926;","&#927;","&#928;","&#929;","&#931;","&#932;","&#933;","&#934;","&#935;","&#936;","&#937;","&#945;","&#946;","&#947;","&#948;","&#949;","&#950;","&#951;","&#952;","&#953;","&#954;","&#955;","&#956;","&#957;","&#958;","&#959;","&#960;","&#961;","&#962;","&#963;","&#964;","&#965;","&#966;","&#967;","&#968;","&#969;","&#977;","&#978;","&#982;","&#8226;","&#8230;","&#8242;","&#8243;","&#8254;","&#8260;","&#8472;","&#8465;","&#8476;","&#8482;","&#8501;","&#8592;","&#8593;","&#8594;","&#8595;","&#8596;","&#8629;","&#8656;","&#8657;","&#8658;","&#8659;","&#8660;","&#8704;","&#8706;","&#8707;","&#8709;","&#8711;","&#8712;","&#8713;","&#8715;","&#8719;","&#8721;","&#8722;","&#8727;","&#8730;","&#8733;","&#8734;","&#8736;","&#8743;","&#8744;","&#8745;","&#8746;","&#8747;","&#8756;","&#8764;","&#8773;","&#8776;","&#8800;","&#8801;","&#8804;","&#8805;","&#8834;","&#8835;","&#8836;","&#8838;","&#8839;","&#8853;","&#8855;","&#8869;","&#8901;","&#8968;","&#8969;","&#8970;","&#8971;","&#9001;","&#9002;","&#9674;","&#9824;","&#9827;","&#9829;","&#9830;"],HTML2Numerical:function(e){return this.swapArrayVals(e,this.arr1,this.arr2)},NumericalToHTML:function(e){return this.swapArrayVals(e,this.arr2,this.arr1)},numEncode:function(e){if(this.isEmpty(e))return"";for(var t=[],n=e.length,r=0;r<n;r++){var o=e.charAt(r);o<" "||"~"<o?(t.push("&#"),t.push(o.charCodeAt()),t.push(";")):t.push(o)}return t.join("")},htmlDecode:function(e){var t,n,r,o=e;if(this.isEmpty(o))return"";if(null!=(r=(o=this.HTML2Numerical(o)).match(/&#[0-9]{1,5};/g)))for(var i=0;i<r.length;i++)o=-32768<=(t=(n=r[i]).substring(2,n.length-1))&&t<=65535?o.replace(n,String.fromCharCode(t)):o.replace(n,"");return o},htmlEncode:function(e,t){return this.isEmpty(e)?"":((t=t||!1)&&(e="numerical"==this.EncodeType?e.replace(/&/g,"&#38;"):e.replace(/&/g,"&amp;")),e=this.XSSEncode(e,!1),"numerical"!=this.EncodeType&&t||(e=this.HTML2Numerical(e)),e=this.numEncode(e),t||(e=e.replace(/&#/g,"##AMPHASH##"),e=(e="numerical"==this.EncodeType?e.replace(/&/g,"&#38;"):e.replace(/&/g,"&amp;")).replace(/##AMPHASH##/g,"&#")),e=e.replace(/&#\d*([^\d;]|$)/g,"$1"),t||(e=this.correctEncoding(e)),"entity"==this.EncodeType&&(e=this.NumericalToHTML(e)),e)},XSSEncode:function(e,t){return this.isEmpty(e)?"":e=(t=t||!0)?(e=(e=(e=e.replace(/\'/g,"&#39;")).replace(/\"/g,"&quot;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"):(e=(e=(e=e.replace(/\'/g,"&#39;")).replace(/\"/g,"&#34;")).replace(/</g,"&#60;")).replace(/>/g,"&#62;")},hasEncoded:function(e){return!!/&#[0-9]{1,5};/g.test(e)||!!/&[A-Z]{2,6};/gi.test(e)},stripUnicode:function(e){return e.replace(/[^\x20-\x7E]/g,"")},correctEncoding:function(e){return e.replace(/(&amp;)(amp;)+/,"$1")},swapArrayVals:function(e,t,n){if(this.isEmpty(e))return"";var r;if(t&&n&&t.length==n.length)for(var o=0,i=t.length;o<i;o++)r=new RegExp(t[o],"g"),e=e.replace(r,n[o]);return e},inArray:function(e,t){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}},i=(function(t){var e=function(e){return e&&(this.EncodeType=e),this};(0,r._extend)(e.prototype,o);var n=new e;Object.defineProperty(t.exports,"EncodeType",{enumerable:!0,get:function(){return n.EncodeType},set:function(e){return n.EncodeType=e}}),["HTML2Numerical","NumericalToHTML","numEncode","htmlDecode","htmlEncode","XSSEncode","hasEncoded","stripUnicode","correctEncoding"].forEach(function(e){t.exports[e]=n[e].bind(n)}),t.exports.Encoder=e}(t={exports:{}},t.exports),t.exports),n=(i.Encoder,"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}),c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),g=function(e){return!(!e.contentEditable||"true"!==e.contentEditable)},u=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.customPos,n=e.iframe,r=e.noShadowCaret;return n?{iframe:n,window:n.contentWindow,document:n.contentDocument||n.contentWindow.document,noShadowCaret:r,customPos:t}:{window:window,document:document,noShadowCaret:r,customPos:t}},p=function(e,t){var n=t&&t.window||window,r=t&&t.document||document,o=e.getBoundingClientRect(),i=r.documentElement,a=n.pageXOffset||i.scrollLeft,c=n.pageYOffset||i.scrollTop;return{top:o.top+c,left:o.left+a}},l=function(e){return"object"===(void 0===e?"undefined":n(e))&&null!==e},f=function(e){var t=e.nodeName;return"TEXTAREA"==t||"INPUT"==t},d=function(e){return f(e)||(e=function e(t){return g(t)?t:!!t.parentElement&&e(t.parentElement)}(e)),e},m=function n(e){return e instanceof NodeList&&[].slice.call(e).reduce(function(e,t){return e+n(t)},""),e instanceof Element?f(e)?e.value:i.htmlDecode(e.innerText):""},v=function(e){return e&&"[object Function]"==={}.toString.call(e)},y=function(e,t){return g(e)?(l=e,f=t,{get:function(){if(f.window.getSelection){var e=f.window.getSelection();if(0<e.rangeCount){var t=e.getRangeAt(0);return{element:t.startContainer,Start:t.startOffset,End:t.endOffset}}}},getPos:a=function(){var e=d(),t=e.cloneRange();t.selectNodeContents(l),t.setEnd(e.endContainer,e.endOffset);var n=t.toString().length;return t.detach(),n},setPos:function(a){var c=f.window.getSelection();if(c){var s=0,u=!1;!function e(t,n){for(var r=0;r<n.childNodes.length;r++){var o=n.childNodes[r];if(u)break;if(3===o.nodeType){if(s+o.length>=t){u=!0;var i=f.document.createRange();i.setStart(o,t-s),c.removeAllRanges(),c.addRange(i);break}s+=o.length}else e(a,o)}}(a,l)}return l},getPosition:function(){var e=i(),t=a(),n=l.getBoundingClientRect(),r=n.top+f.document.body.scrollTop,o=n.left+f.document.body.scrollLeft;return e.left-=o,e.top-=r,e.pos=t,e},getOffset:i=function(){var e=d(),t={height:0,left:0,right:0};if(!e)return t;var n=f.customPos||0===f.customPos;if(0<e.endOffset-1&&e.endContainer!==l||n){var r=e.cloneRange(),o=n?f.customPos:e.endOffset;r.setStart(e.endContainer,o-1<0?0:o-1),r.setEnd(e.endContainer,o);var i=r.getBoundingClientRect();t={height:i.height,left:i.left+i.width,top:i.top},r.detach()}if((!t||t&&0===t.height)&&!f.noShadowCaret){var a=e.cloneRange(),c=f.document.createTextNode("|");a.insertNode(c),a.selectNode(c);var s=a.getBoundingClientRect();t={height:s.height,left:s.left,top:s.top},c.parentNode.removeChild(c),a.detach()}if(t){var u=f.document.documentElement;t.top+=f.window.pageYOffset-(u.clientTop||0),t.left+=f.window.pageXOffset-(u.clientLeft||0)}return t},getRange:d=function(){if(f.window.getSelection){var e=f.window.getSelection();return 0<e.rangeCount?e.getRangeAt(0):null}}}):(c=e,s=t,r=function(e){var t=function(e){return e.replace(/<|>|`|"|&/g,"?").replace(/\r\n|\r|\n/g,"<br/>")};(s.customPos||0===s.customPos)&&(e=s.customPos);var n=void 0===e?u():e,r=c.value.slice(0,n),o=c.value.slice(n),i='<span style="position: relative; display: inline;">'+t(r)+"</span>";i+='<span id="caret-position-marker" style="position: relative; display: inline;">|</span>',i+='<span style="position: relative; display: inline;">'+t(o)+"</span>";var a=h(c,i).rect();return a.pos=u(),a},{get:function(){return{element:c,Start:c.selectionStart,End:c.selectionEnd}},getPos:u=function(){return c.selectionStart},setPos:function(e){return c.setSelectionRange(e,e),c},getOffset:function(e){var t=p(c),n=r(e);return{top:t.top+n.top+s.document.body.scrollTop,left:t.left+n.left+s.document.body.scrollLeft,height:n.height}},getPosition:r});var l,f,i,d,a,c,s,u,r},E=Object.freeze({position:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};l(t)&&(n=t,t=null);var r=u(n),o=y(e,r);return t||0===t?o.setPos(t):o.getPosition()},caretPosition:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};l(t)&&(n=t,t=null);var r=u(n);return y(e,r)},offset:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};l(t)&&(n=t,t=null);var r=u(n);return y(e,r).getOffset(t)},getOffset:p}),b=function(){function e(){c(this,e),this.CaretPos=E,this.caret,this.target,this.startAt,this.stopAt}return s(e,[{key:"_triggerCaretChange",value:function(t){this.caretChangeHandler.map(function(e){e(t)})}},{key:"_triggerCaretOff",value:function(t){this.caretOffHandler.map(function(e){e(t)})}},{key:"_triggerCaretOn",value:function(t){this.caretOnHandler.map(function(e){e(t)})}},{key:"onCaretChange",value:function(e){if(!v(e))throw new Error("onCaretChange must receive a function as parameter");this.caretChangeHandler.push(e)}},{key:"onCaretOff",value:function(e){if(!v(e))throw new Error("onCaretOff must receive a function as parameter");this.caretOffHandler.push(e)}},{key:"onCaretOn",value:function(e){if(!v(e))throw new Error("onCaretOn must receive a function as parameter");this.caretOnHandler.push(e)}},{key:"forceSelection",value:function(e,t,n){var r=e.childNodes[0],o=window.getSelection(),i=document.createRange();i.setStart(r,t),i.setEnd(r,n),o.removeAllRanges(),o.addRange(i),this._triggerCaretChange({type:"CaretChange",target:this.target,caret:this.caret,startAt:this.startAt,stopAt:this.stopAt,content:m(this.target),selectedText:this.getSelectedText(),charBeforCaret:this.getCharBeforCaret()})}},{key:"disable",value:function(){null!=this.target&&(this.target.removeEventListener("blur",this._autoDisableHandler,!0),this._triggerCaretOff({type:"CaretOff",target:this.target})),this.target=null,this.startAt=null,this.stopAt=null}},{key:"_autoDisableHandler",value:function(){}},{key:"enable",value:function(e){if(!(e instanceof Element))throw new Error("Caret must receive an Element as target");this.caret=this.CaretPos.caretPosition(e);var t=this.caret.get();if(isNaN(t.Start)||isNaN(t.End)||t.Start<0||t.End<0)throw new Error("Troubble during Ranging");if(this.target!=e){this._triggerCaretOn({type:"CaretOn",target:e});var n=this;this._autoDisableHandler=function(){n.disable()},e.addEventListener("blur",this._autoDisableHandler,!0)}this.target=e,this.startAt=t.Start,this.stopAt=t.End}},{key:"getTarget",value:function(){return this.target}},{key:"getSelectedText",value:function(){return this.target&&this.startAt!=this.stopAt?m(this.target).substring(this.startAt,this.stopAt):null}},{key:"getCharBeforCaret",value:function(){return!this.target||this.startAt<1?null:m(this.target).charAt(this.startAt-1)}}]),e}(),w=function(e){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document,t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];c(this,r);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return n.caretChangeHandler=[],n.caretOffHandler=[],n.caretOnHandler=[],t&&("complete"!==document.readyState?window.onload=function(){return n._init(e)}:n._init(e)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,b),s(r,[{key:"_init",value:function(e){var t=this;"string"==typeof e&&(e=document.querySelectorAll(e));var n=function(e){e.addEventListener("keyup",t._handleEvent.bind(t),!0),e.addEventListener("mouseup",t._handleEvent.bind(t),!0),e.addEventListener("selectionchange",t._handleEvent.bind(t),!0)};e instanceof NodeList?e.forEach(n):e instanceof Element?n(e):e instanceof Document&&n(e)}},{key:"_beforeHandleBlurEvent",value:function(){}},{key:"_handleEvent",value:function(e){e.preventDefault();var t;return!1!==(t=d(e.target))?(this.enable(t),this._triggerCaretChange({type:"CaretChange",target:this.target,caret:this.caret,startAt:this.startAt,stopAt:this.stopAt,content:m(this.target),selectedText:this.getSelectedText(),charBeforCaret:this.getCharBeforCaret()})):this.disable(),!0}}]),r}();e.Caret=w,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=main.min.js.map
